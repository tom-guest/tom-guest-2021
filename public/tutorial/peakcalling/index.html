<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.1.0">
  <meta name="generator" content="Hugo 0.55.6" />

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Tom Guest">

  
  
  
    
  
  <meta name="description" content="Introduction In this tutorial we will use MACS to call peaks.
How-to install MACS MACS2 runs in python (v2.7, not 3). You will need to download and install python and numpy.
 Download Python 2.7
 Then download the numpy.whl file numpy
  Using the Terminal, navigate to the folder containing the numpy.whl file and then install numpy by entering:
pip install numpy.whl
 Download the tarfile for MACS, extract it (by double-clicking on Mac)">

  
  <link rel="alternate" hreflang="en-us" href="https://tomguest.netlify.com/tutorial/peakcalling/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#f2671d">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans|Pontano+Sans|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
  

  
  <link rel="alternate" href="https://tomguest.netlify.com/index.xml" type="application/rss+xml" title="Tom Guest ">
  <link rel="feed" href="https://tomguest.netlify.com/index.xml" type="application/rss+xml" title="Tom Guest ">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://tomguest.netlify.com/tutorial/peakcalling/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@tom_guest">
  <meta property="twitter:creator" content="@tom_guest">
  
  <meta property="og:site_name" content="Tom Guest ">
  <meta property="og:url" content="https://tomguest.netlify.com/tutorial/peakcalling/">
  <meta property="og:title" content="Peak calling | Tom Guest ">
  <meta property="og:description" content="Introduction In this tutorial we will use MACS to call peaks.
How-to install MACS MACS2 runs in python (v2.7, not 3). You will need to download and install python and numpy.
 Download Python 2.7
 Then download the numpy.whl file numpy
  Using the Terminal, navigate to the folder containing the numpy.whl file and then install numpy by entering:
pip install numpy.whl
 Download the tarfile for MACS, extract it (by double-clicking on Mac)"><meta property="og:image" content="https://tomguest.netlify.com/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-07-04T00:00:00&#43;01:00">
  
  <meta property="article:modified_time" content="2019-07-04T00:00:00&#43;01:00">
  

  

  

  <title>Peak calling | Tom Guest </title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Tom Guest </a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Learning R</span>
            
          </a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>



<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" id="search-query" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/tutorial/">ChIP-seq with R</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/tutorial/">Overview</a>
      </li>
      
      <li >
        <a href="/tutorial/bioconductor_intro/">Introduction to Bioconductor</a>
      </li>
      
      <li >
        <a href="/tutorial/bsgenome/">Forging a BSgenome package</a>
      </li>
      
      <li >
        <a href="/tutorial/alignment/">Aligning to a reference genome</a>
      </li>
      
      <li >
        <a href="/tutorial/normalisation/">Normalising read counts</a>
      </li>
      
      <li class="active">
        <a href="/tutorial/peakcalling/">Peak calling</a>
      </li>
      
      <li >
        <a href="/tutorial/motif/">De-novo motif finding</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
      <p class="docs-toc-title">On this page</p>
      

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#how-to-install-macs">How-to install MACS</a></li>
<li><a href="#macs2-parameters">MACS2 parameters</a></li>
<li><a href="#using-macs2-to-call-peaks">Using MACS2 to call peaks</a></li>
<li><a href="#using-peak-information-into-r">Using peak information into R</a>
<ul>
<li><a href="#why-import-peaks">Why import peaks?</a></li>
<li><a href="#reading-peak-data-into-r">Reading peak data into R</a></li>
<li><a href="#finding-genes-adjacent-to-peaks">Finding genes adjacent to peaks</a>
<ul>
<li><a href="#install-chipseeker">Install ChIPseeker</a></li>
<li><a href="#create-a-txdb-object">Create a TxDB object</a></li>
<li><a href="#annotate-peaks">Annotate peaks</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>

      <ul class="nav toc-top">
        <li><a href="#">Back to top</a></li>
      </ul>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article" itemscope itemtype="http://schema.org/Article">

        <div class="docs-article-container">
          <h1 itemprop="name">Peak calling</h1>

          <div class="article-style" itemprop="articleBody">
            

<h2 id="introduction">Introduction</h2>

<p>In this tutorial we will use MACS to call peaks.</p>

<h2 id="how-to-install-macs">How-to install MACS</h2>

<p>MACS2 runs in python (v2.7, not 3). You will need to download and install python and numpy.</p>

<ul>
<li><p>Download <a href="https://www.python.org" target="_blank">Python 2.7</a></p></li>

<li><p>Then download the <code>numpy.whl</code> file <a href="https://pypi.org/project/numpy/" target="_blank">numpy</a></p></li>
</ul>

<p>Using the Terminal, navigate to the folder containing the <code>numpy.whl</code> file and then install numpy by entering:</p>

<p><code>pip install numpy.whl</code></p>

<ul>
<li><p>Download the tarfile for <a href="https://pypi.org/project/MACS2" target="_blank">MACS</a>, extract it (by double-clicking on Mac)</p></li>

<li><p>Navigate to the folder containing the extracted MACS files in Terminal and run:</p></li>
</ul>

<p><code>python setup.py install</code></p>

<h2 id="macs2-parameters">MACS2 parameters</h2>

<p><code>-t</code>: treatment file<br />
<code>-c</code>: control file<br />
<code>--format</code>: the input file format, e.g.. BAM<br />
<code>--gsize</code>: the size of the genome (or chromosome)<br />
<code>--name</code>: a name to append to the output files<br />
<code>--bw</code>: &lsquo;bandwidth&rsquo; the average size of the DNA fragments (after sonication)</p>

<p>You can find out more information about MACS2 parameters on the <a href="https://github.com/taoliu/MACS" target="_blank">Github page</a>, or by typing <code>macs2</code> into the Terminal command line.</p>

<h2 id="using-macs2-to-call-peaks">Using MACS2 to call peaks</h2>

<p>To run MACS you will need to navigate to the folder containing your BAM alignment files. Using the <code>cd</code> command to change directory.</p>

<p>From here you need to call <code>macs2 callpeak</code> with the parameters you wish to use. If you have multiple replicates you can either call peaks with them both at the same time or separately. Peak calling works with and without a control sample.</p>

<p><code>macs2 callpeak -t treatment_rep1.bam treatment_rep2.bam -c control_rep1.bam control_rep2.bam --format BAM  --gsize &lt;genome_size&gt; --name &quot;rep1andrep2&quot;  --bw 400 --nomodel</code></p>

<p>In this example macs 2 call peak function is called on two replicate treatment files BAM files, with 2 control files. The format is specified as <code>BAM</code>, replace <code>&lt;genome_size&gt;</code> with the size of the genome/chromosome, for example: <code>2961149</code> for chromosome I of <em>V.cholerae</em>. The bandwidth is set to 400 and have told macs not to use its model function.</p>

<p>The function prints to the console as it is working and when it is complete you will see <code>Done!</code>. It produces an excel sheet (which is actually a <code>.csv</code> file), some <code>.BED</code> files, <code>.narrowPEAK</code> (which is tab-delimited list of peaks) and some logs.</p>

<p>They all contain the same information, but the excel sheet is probably the most user-friendly. BED files can be opened in some genome browsers.</p>

<p>I recommend moving the MACS output into a macs folder within your project structure, rather than keeping the output files with your alignments.</p>

<h2 id="using-peak-information-into-r">Using peak information into R</h2>

<h3 id="why-import-peaks">Why import peaks?</h3>

<p>You can easily import all the information in the excel sheet into R. This can then be used for visualisation, finding the nearest genes, calculating the distance from peak centres to the nearest transcription start site etc..<br />
You can use R to calculate the centre of the peak (based on the start and end, recognised by MACS) or if you wish to use a genome browser to manually select peak centres you could do this by amending the data in Excel.</p>

<p>This can then be used to extract the DNA sequence upstream/downstream of the peak centres in <code>.fasta</code> format to perform de-novo motif finding with MEME.</p>

<h3 id="reading-peak-data-into-r">Reading peak data into R</h3>

<p>Since the <code>.xls</code> file is actually a <code>.csv</code> file in disguise it can be easily imported into R. The file also contains ~20 lines of information before the peak data, these lines start with a # so we can tell R to ignore those lines.</p>

<pre><code class="language-r">peaks_dataFrame &lt;- read.delim(&quot;/macs/rep1andrep2.xls&quot;,
  comment.char = &quot;#&quot;)
</code></pre>

<h3 id="finding-genes-adjacent-to-peaks">Finding genes adjacent to peaks</h3>

<p>To find the genes that are adjacent to the peaks we will use the <code>ChIPseeker</code> <a href="https://www.bioconductor.org/packages/release/bioc/html/ChIPseeker.html" target="_blank">package</a>.</p>

<h4 id="install-chipseeker">Install ChIPseeker</h4>

<pre><code class="language-r">if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE))
    install.packages(&quot;BiocManager&quot;)
BiocManager::install(&quot;ChIPseeker&quot;, version = &quot;3.8&quot;)
</code></pre>

<h4 id="create-a-txdb-object">Create a TxDB object</h4>

<p>A TxDB object contains genome annotation information that you will need to annotate peaks with genomic information. It is very simple to make, once you have done you can save and reload it whenever you wish to use it.</p>

<ul>
<li>Download a GFF or GTF annotation file (from NCBI) and keep it in your <code>genomes</code> folder.<br /></li>
</ul>

<pre><code class="language-r">library(GenomicFeatures)
library(AnnotationDbi)
&lt;genomeName&gt;TxDB &lt;- makeTxDbFromGFF(&quot;genomes/annotation&lt;genomeName&gt;.gff&quot;)
saveDb(&lt;genomeName&gt;TxDB, file=&quot;genomes/&lt;genomeName&gt;TxDB.satellite&quot;)
</code></pre>

<ul>
<li>Loading the TxDB file (replacing <genome>, with a name for the genome you are using):</li>
</ul>

<pre><code class="language-r">&lt;genome&gt;Annotation &lt;- loadDb(&quot;genomes/&lt;genomeName&gt;TxDB.sqlite&quot;)
</code></pre>

<h4 id="annotate-peaks">Annotate peaks</h4>

<p>You will need to convert your data frame containing the peak data into a GRange object, this can easily be done with the <code>makeGRangesFromDataFrame()</code> function from the GenomicRanges package.</p>

<pre><code class="language-r">peaks_gr &lt;- makeGRangesFromDataFrame(peaks_dataFrame, keep.extra.columns=TRUE)
</code></pre>

<p>By default the function removes any extra columns and only keeps chr, start and end. Setting the parameter <code>keep.extra.columns</code> to TRUE will prevent this.</p>

<p>Then you can use the <code>annotatePeak()</code> function. You will need to direct it to your GRange and to a TxDb object that contains the genome annotation for the species you are working with.</p>

<pre><code class="language-r">library(ChIPseeker)
annotatedPeaks &lt;- annotatePeak(peaks_gr, TxDb = &lt;genome&gt;Annotation)
</code></pre>

<p>Making a data frame with your annotated data makes it more useful, and you can export it as <code>.csv</code> file to save and open later in R, Excel or in other software.</p>

<pre><code class="language-r">annotatedPeaksDF &lt;- as.data.frame(annotatedPeaks)
write.csv(annotatedPeaksDF, file = &quot;annotation/rep1andrep2.csv&quot;)
</code></pre>

          </div>

          

        </div>

        <div class="body-footer">
          Last updated on Jul 4, 2019
        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.d7381f2d79e6271d4da28f474f49096c.js"></script>

  </body>
</html>


